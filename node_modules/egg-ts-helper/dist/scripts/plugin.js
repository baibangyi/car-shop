"use strict";
/**
 * Getting plugin info in child_process to prevent effecting egg application( splitting scopes ).
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const fs_1 = tslib_1.__importDefault(require("fs"));
const utils_1 = require("../utils");
const eggUtils = tslib_1.__importStar(require("egg-utils"));
const url = process.argv[2];
const stat = fs_1.default.statSync(url);
let pluginInfos;
if (stat.isDirectory()) {
    const framework = eggUtils.getFrameworkOrEggPath(url);
    if (!framework) {
        process.exit(0);
    }
    pluginInfos = eggUtils.getPlugins({
        baseDir: url,
        framework,
        env: 'local',
    });
}
else if (stat.isFile()) {
    pluginInfos = {};
    const config = utils_1.requireFile(url);
    for (const name in config) {
        const plugin = config[name];
        if (typeof plugin === 'boolean') {
            pluginInfos[name] = { enable: plugin };
        }
        else {
            pluginInfos[name] = {};
            ['package', 'enable'].forEach(k => {
                if (k in plugin) {
                    pluginInfos[name][k] = plugin[k];
                }
            });
        }
    }
}
process.stdout.write(JSON.stringify(pluginInfos));
//# sourceMappingURL=plugin.js.map